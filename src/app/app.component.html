<div class="app-layout">

  <!-- Top Bar -->
  <header class="topbar">
    <div class="logo">ğŸ‘µ Family Tags</div>

    <div class="actions">
      <button (click)="startPointMode()">Add Pin</button>
      <button (click)="startPolyMode()">Draw Area</button>
      <button (click)="cancelDraw()">Stop</button>
      <button (click)="zoomOut()">-</button>
      <button (click)="zoomIn()">+</button>
      <button (click)="resetView()">Reset</button>
      <button (click)="exportJSON()">Export</button>
      <label class="import-btn">
        Import<input type="file" accept="application/json" (change)="importJSON($event)" hidden>
      </label>
    </div>
  </header>

  <main class="content">
    <!-- LEFT PANEL -->
    <aside class="sidebar">
      <h3>People ({{ annotations.length }})</h3>
      <div class="people-list">
        <div class="person" *ngFor="let a of annotations">
          <div class="name">{{ a.name }}</div>
          <div class="sub">{{ a.type }} Â· {{ a.createdAt | date:'short' }}</div>
          <div class="actions">
            <button (click)="renameAnn(a)">âœï¸</button>
            <button (click)="deleteAnn(a)">ğŸ—‘ï¸</button>
          </div>
        </div>
      </div>
    </aside>

    <!-- IMAGE AREA -->
    <section class="canvas-area">
      <div class="stage" #wrap (mousemove)="onMouseMove($event)" (click)="onCanvasClick($event)"
           (wheel)="onWheel($event)" (mousedown)="onDragStart($event)" [ngStyle]="stageStyle">

        <img #imgEl src="images/family.jpeg" alt="Family" (load)="onImageLoad()" draggable="false"/>

        <svg #svg class="overlay">
          <ng-container *ngFor="let a of annotations">
            <circle *ngIf="a.type==='point'"
                    [attr.cx]="a.points[0].xPct * 100 + '%'"
                    [attr.cy]="a.points[0].yPct * 100 + '%'"
                    r="0.9%" fill="#14b8a6" opacity="0.9"></circle>

            <polygon *ngIf="a.type==='polygon'"
                     [attr.points]="getDrawingPolygonPoints(a.points)"
                     fill="#facc15" fill-opacity="0.22" stroke="#facc15" stroke-width="1.5"></polygon>
          </ng-container>

          <polyline *ngIf="drawingPolygon.length"
                    [attr.points]="getDrawingPolygonPoints(drawingPolygon)"
                    stroke="#facc15" stroke-width="1.5" fill="none" stroke-dasharray="4 4"/>
        </svg>
      </div>
    </section>
  </main>

  <!-- Tooltip -->
  <div class="tooltip" *ngIf="tooltip()" [style.left.px]="tooltip()!.x" [style.top.px]="tooltip()!.y">
    {{ tooltip()!.text }}
  </div>
</div>