<div class="app-layout">

  <!-- Top Bar -->
  <header class="topbar">
    <div class="title">üëµ Family Tags</div>
    <div class="actions">
      <button (click)="uploadImage()">Upload Image</button>
      <button (click)="resetAnnotations()">Reset Annotations</button>
      <button (click)="save()">Save</button>
      <button (click)="exportAsImage()">Export Image</button>
      <button (click)="exportAsPDF()">Export PDF</button>
    </div>
  </header>

  <main class="content">
    <!-- LEFT PANEL -->
    <aside class="sidebar">
      <h3>People ({{ annotations.length }})</h3>
      <div class="people-list">
        <div class="person" *ngFor="let a of annotations">
          <div class="num">{{ a.label }}</div>
          <div class="name">{{ a.name }}</div>
          <div class="actions">
            <button (click)="renameAnn(a)">‚úèÔ∏è</button>
            <button class="danger" (click)="deleteAnn(a)">üóëÔ∏è</button>
          </div>
        </div>
      </div>
    </aside>

    <!-- IMAGE AREA -->
    <section class="canvas-area">
      <div class="stage" #wrap (mousedown)="startDrag($event)" (mousemove)="dragMove($event)"
        (mouseup)="endDrag($event)">

        <div class="no-image" *ngIf="!imageSrc">
          <p>No image selected</p>
          <button (click)="triggerImageSelect()">Upload Image</button>
        </div>

        <input #imageInput type="file" accept="image/*" style="display: none" (change)="onImageSelected($event)" />
        <img *ngIf="imageSrc" [src]="imageSrc" alt="Loaded Family" draggable="false" />

        <svg class="overlay">
          <!-- existing annotations -->
          <ng-container *ngFor="let a of annotations">

            <!-- vertical line -->
            <line [attr.x1]="a.start.xPct * 100 + '%'" [attr.y1]="a.start.yPct * 100 + '%'"
              [attr.x2]="a.end.xPct * 100 + '%'" [attr.y2]="a.end.yPct * 100 + '%'" stroke="white" stroke-width="2">
            </line>

            <!-- number bubble -->
            <circle [attr.cx]="a.end.xPct * 100 + '%'" [attr.cy]="a.end.yPct * 100 + '%'" r="1.2%" fill="white">
            </circle>

            <text [attr.x]="a.end.xPct * 100 + '%'" [attr.y]="a.end.yPct * 100 + '%'" text-anchor="middle"
              alignment-baseline="middle" font-size="0.9rem" fill="black" font-weight="600">
              {{ a.label }}
            </text>
          </ng-container>

          <!-- LIVE DRAW WHILE DRAGGING -->
          <line *ngIf="isDragging" [attr.x1]="dragStart.xPct * 100 + '%'" [attr.y1]="dragStart.yPct * 100 + '%'"
            [attr.x2]="dragCurrent.xPct * 100 + '%'" [attr.y2]="dragCurrent.yPct * 100 + '%'" stroke="white"
            stroke-width="2" stroke-dasharray="4 2"></line>
        </svg>
      </div>
    </section>
  </main>
</div>

